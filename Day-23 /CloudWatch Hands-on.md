# Day-23 CloudWatch Hands-on

In today's hands-on lab, we’ll explore how to set up Amazon CloudWatch to monitor your AWS resources and applications. We'll cover:

1. **Creating custom metrics**
2. **Setting up CloudWatch Alarms**
3. **Viewing CloudWatch Logs**
4. **Creating CloudWatch Dashboards**

Let's get started with each step:

---

### **Step 1: Create a Custom Metric in CloudWatch**

You can monitor custom metrics that aren’t automatically collected by AWS using CloudWatch. In this example, we will create a custom metric for tracking the number of website visits.

1. **Step 1:** Open the AWS Management Console and go to **CloudWatch**.
2. **Step 2:** In the left navigation pane, click on **Metrics**.
3. **Step 3:** Click on the **Create Metric** button to define a new custom metric.
4. **Step 4:** Choose **Custom Namespace** and name it something like `TechStoreMetrics`.
5. **Step 5:** Select **Create Metric Data**. Under "Metric Name", type something like `WebsiteVisits`.
6. **Step 6:** Choose **Create**.
7. **Step 7:** Now, you need to push this metric to CloudWatch. Use the AWS CLI, SDK, or an application to push metrics.
    - Example CLI command to send a custom metric:
      ```bash
      aws cloudwatch put-metric-data --namespace "TechStoreMetrics" --metric-name "WebsiteVisits" --value 10 --unit "Count"
      ```

---

### **Step 2: Set Up a CloudWatch Alarm**

Next, let’s set up an alarm to monitor the **CPU utilization** of an EC2 instance. If CPU usage exceeds 80%, you’ll receive an alert.

1. **Step 1:** In the CloudWatch console, click on **Alarms** in the left pane.
2. **Step 2:** Click on **Create Alarm**.
3. **Step 3:** Choose a metric to monitor, for example, **EC2 Metrics**.
4. **Step 4:** Select **Per-Instance Metrics** and choose the instance you want to monitor.
5. **Step 5:** Under **Statistic**, choose **Average**.
6. **Step 6:** Set the threshold condition to **Greater than 80** for CPU Utilization.
7. **Step 7:** Under **Actions**, choose to send a notification. You can use **SNS** (Simple Notification Service) to send an email when the alarm triggers.
    - If you don’t have an SNS topic, create one.
8. **Step 8:** Click on **Create Alarm**.

---

### **Step 3: Set Up CloudWatch Logs**

Let’s now monitor the logs generated by an EC2 instance or an application. In this example, we will assume you want to monitor **web server logs**.

1. **Step 1:** Open the **CloudWatch** console.
2. **Step 2:** In the left pane, click on **Logs**.
3. **Step 3:** Click on **Create Log Group** and give it a name, e.g., `WebServerLogs`.
4. **Step 4:** On your EC2 instance (or any server), install the **CloudWatch Logs Agent** to send logs to CloudWatch.
    - You can do this by running:
      ```bash
      sudo yum install awslogs
      sudo service awslogs start
      ```
5. **Step 5:** In the `awslogs.conf` file, configure it to push logs to the log group you created.
    - Example config for a web server log:
      ```bash
      [/var/log/httpd/access_log]
      log_group_name = WebServerLogs
      log_stream_name = {instance_id}
      ```
6. **Step 6:** After configuring, CloudWatch will automatically start collecting logs from your EC2 instance.
7. **Step 7:** In the **CloudWatch console**, go to **Logs** and see the logs streaming in real time.

---

### **Step 4: Create a CloudWatch Dashboard**

CloudWatch Dashboards allow you to visualize your metrics. Let’s create a dashboard to view the CPU Utilization, custom Website Visits metric, and logs.

1. **Step 1:** Go to **CloudWatch Dashboards** on the left side.
2. **Step 2:** Click on **Create Dashboard**.
3. **Step 3:** Enter a name for your dashboard, such as `TechStoreDashboard`, and click **Create**.
4. **Step 4:** Click **Add widget** to add various metrics to your dashboard.
    - **For EC2 CPU Utilization**: Choose **Metrics**, then **EC2** and select the **CPU Utilization** of your EC2 instance.
    - **For Custom Metric (WebsiteVisits)**: Choose **Metrics**, then **Custom** and select `TechStoreMetrics` → `WebsiteVisits`.
    - **For Logs**: Choose **Log Group** and add the `WebServerLogs` to visualize error logs or request logs.
5. **Step 5:** Click **Create widget** and arrange your metrics as needed.
6. **Step 6:** Click **Save changes**.

You now have a dashboard displaying key metrics like CPU utilization, website visits, and web server logs, all in one place.

---

### **Summary of CloudWatch Hands-on**

- **Custom Metrics:** You can create and push custom metrics (like Website Visits) to CloudWatch.
- **Alarms:** You set up alarms to get notified when certain thresholds are crossed, e.g., high CPU utilization.
- **Logs:** CloudWatch allows you to monitor and analyze logs from your EC2 instances or applications.
- **Dashboards:** You can visualize key metrics and logs using CloudWatch Dashboards, making it easier to monitor your resources.

---

### **Quiz on CloudWatch Hands-on**

1. **What command is used to push custom metrics to CloudWatch?**  
   a) `aws cloudwatch put-metric`  
   b) `aws cloudwatch put-metric-data`  
   c) `aws cloudwatch create-metric`  
   d) `aws cloudwatch set-metric-data`

2. **How can you receive notifications when a CloudWatch alarm is triggered?**  
   a) Via CloudWatch Logs  
   b) By sending an email through SNS  
   c) By stopping the EC2 instance  
   d) By restarting CloudWatch service

3. **What type of logs can you monitor with CloudWatch Logs?**  
   a) Only EC2 instance logs  
   b) Only web server logs  
   c) Any log files from applications or EC2 instances  
   d) Only AWS service logs

4. **What is the benefit of creating a CloudWatch Dashboard?**  
   a) To automatically fix issues  
   b) To visualize multiple metrics in one place  
   c) To manage AWS accounts  
   d) To launch new EC2 instances

5. **True or False: CloudWatch only collects metrics for EC2 instances.**  
   a) True  
   b) False

---

### **Answers:**
1. b) `aws cloudwatch put-metric-data`  
2. b) By sending an email through SNS  
3. c) Any log files from applications or EC2 instances  
4. b) To visualize multiple metrics in one place  
5. b) False

---

### **Conclusion:**

In this hands-on session, you learned how to set up CloudWatch for monitoring your AWS resources. You created custom metrics, set alarms, viewed logs, and built dashboards to visualize your metrics in real-time. CloudWatch is an essential tool for ensuring the health and performance of your applications and AWS resources, allowing you to quickly react to potential issues and optimize your infrastructure.
